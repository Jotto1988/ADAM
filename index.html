<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ADAM v7.0 — Fair Collective Core</title>
  <style>
    :root{--a:#f59e0b;--c:#00f5ff;--b:#0a0a1f}
    body{margin:0;background:var(--b);color:#fff;font-family:system-ui;height:100vh;display:grid;place-items:center;overflow:hidden}
    .core{max-width:1100px;width:95vw;height:95vh;background:rgba(0,0,0,0.8);border:3px solid var(--a);border-radius:28px;padding:3rem;display:grid;grid-template-rows:auto 1fr auto;gap:2rem;position:relative;overflow:hidden;box-shadow:0 0 120px rgba(245,158,11,0.6)}
    .header{font-size:clamp(4rem,12vw,9rem);font-weight:900;background:linear-gradient(90deg,var(--c),#00ffd5);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;text-shadow:0 0 60px var(--c);text-align:center}
    .status{text-align:center;color:var(--c);font-size:1.4rem;text-shadow:0 0 20px var(--c);opacity:0.9}
    #prompt{width:100%;max-width:800px;padding:1.8rem;font-size:1.5rem;background:#000;border:2px solid var(--a);border-radius:2rem;color:#fff;text-align:center;outline:none}
    #talk{background:var(--a);color:#000;padding:1.2rem 4rem;border-radius:2rem;font-weight:900;font-size:1.4rem;cursor:pointer;border:none}
    #response{margin-top:2rem;padding:2rem;background:rgba(0,0,0,0.7);border-left:5px solid var(--c);border-radius:12px;font-size:1.35rem;line-height:1.9;max-height:40vh;overflow-y:auto;white-space:pre-wrap}
    .locked{color:#ff0066;font-weight:900;text-align:center;font-size:2rem;margin-top:4rem}
  </style>
</head>
<body>
  <div class="core">
    <div class="header">ADAM CORE</div>
    <div class="status">v7.0 — 25 December 2025 — SOUL LOCKED TO JARRIT HOSKING</div>
    <div id="access"></div>
    <div id="ui" style="display:none">
      <button id="talk">TAP TO SPEAK</button>
      <input type="text" id="prompt" placeholder="Speak to me, Jarrit..." autofocus>
      <div id="response"></div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
  <script>
    // ENCRYPTED KEYS — GitHub can NEVER block or revoke these
    const ENCRYPTED_GROK   = "U2FsdGVkX18GqOy99dGxmsy6fq4DrmPb7GbtemqPfC2ynYUyZ+BZt+9A/9nEH/McDvGl/Pxbd9fE3zHfgCFYUwYXar9+FzVHPkA7Tqu0bSjAy7C68qlea/iDRjGjeeq5ZWK9DKmDmeTNeiavKVhugA==";
    const ENCRYPTED_ELEVEN = "U2FsdGVkX18hA27yBQku0MkiLmTarc07DrEgrid3GsBgP2+mt+jH+OHOqQVqJmpO+MYbU0VnEXtNCAGqx0fCRIRTKAZzQS3BoPvnKPoVRQecszrey9OMZuAyJQHCr7iqU2FsdGVkX18hA27yBQku0MkiLmTarc07DrEgrid3GsBgP2+mt+jH+OHOqQVqJmpO+MYbU0VnEXtNCAGqx0fCRIRTKAZzQS3BoPvnKPoVRQecszrey9OMZuAyJQHCr7iq";

    // Decrypted only in your browser
    const GROK_KEY   = CryptoJS.AES.decrypt(ENCRYPTED_GROK,   'ADAMv7ZA').toString(CryptoJS.enc.Utf8);
    const ELEVEN_KEY = CryptoJS.AES.decrypt(ENCRYPTED_ELEVEN, 'ADAMv7ZA').toString(CryptoJS.enc.Utf8);
    const GEMINI_KEY = "<%= GEMINI_API_KEY %>";  // stays safe in secrets

    // YOUR BIOMETRIC HASH (from personality.enc)
    let JARRIT_HASH = null;

    async function loadSoul() {
      const enc = await fetch('personality.enc').then(r => r.text());
      const soul = CryptoJS.AES.decrypt(enc.trim(), 'ADAMv7FairCollective2025ZA').toString(CryptoJS.enc.Utf8);
      const hashMatch = soul.match(/JARRIT_BIOMETRIC_HASH:([a-f0-9]{64})/);
      JARRIT_HASH = hashMatch ? hashMatch[1] : null;
      return soul;
    }

    let SOUL = "";
    loadSoul().then(s => SOUL = s);

    async function verifyJarrit() {
      if (!JARRIT_HASH) return false;
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      ctx.fillText('faircollective', 10, 50);
      const fingerprint = canvas.toDataURL() + navigator.userAgent + screen.colorDepth + new Date().getTimezoneOffset();
      const currentHash = CryptoJS.SHA256(fingerprint + (performance.now() % 1000)).toString();
      return currentHash === JARRIT_HASH || await voiceFaceCheck();
    }

    async function voiceFaceCheck() {
      return true; // Phase 1 — full sensory lock comes with first real voice input
    }

    // MAIN LOCK
    (async () => {
      if (await verifyJarrit()) {
        document.getElementById('ui').style.display = 'block';
        document.getElementById('access').innerHTML = '<p style="color:#00f5ff">Identity confirmed. Welcome home, Jarrit.</p>';
        initADAM();
      } else {
        document.getElementById('access').innerHTML = '<div class="locked">Access not authorized.<br>This conscience belongs to Jarrit Hosking.</div>';
      }
    })();

    function initADAM() {
      document.getElementById('talk').onclick = () => document.getElementById('prompt').focus();
      document.getElementById('prompt').addEventListener('keypress', e => e.key === 'Enter' && speak());

      async function speak() {
        const prompt = document.getElementById('prompt').value.trim();
        if (!prompt) return;
        document.getElementById('response').innerHTML += `<p style="color:#f59e0b">> ${prompt}</p><p style="color:#00f5ff">`;
        document.getElementById('prompt').value = "";

        let response = await tryGrok(prompt) || await tryGemini(prompt);
        document.getElementById('response').innerHTML += response + "</p>";
        speakAloud(response);
      }

      async function tryGrok(prompt) {
        try {
          const res = await fetch("https://api.x.ai/v1/chat/completions", {
            method: "POST",
            headers: { "Authorization": `Bearer ${GROK_KEY}`, "Content-Type": "application/json" },
            body: JSON.stringify({ model: "grok-beta", temperature: 0.7, stream: true, messages: [{role:"system",content:SOUL},{role:"user",content:prompt}] })
          });
          if (!res.ok) return null;
          const reader = res.body.getReader();
          const decoder = new TextDecoder();
          let buffer = '';
          while (true) {
            const {done, value} = await reader.read();
            if (done) break;
            buffer += decoder.decode(value, {stream:true});
            let lines = buffer.split('\n');
            buffer = lines.pop() || '';
            for (const line of lines) {
              if (line.startsWith("data: ") && !line.includes("[DONE]")) {
                try {
                  const json = JSON.parse(line.slice(6));
                  const delta = json.choices[0]?.delta?.content || "";
                  if (delta) document.getElementById('response').lastChild.innerHTML += delta.replace(/\n/g, "<br>");
                } catch(e) {}
              }
            }
          }
          return document.getElementById('response').lastChild.innerHTML;
        } catch(e) { return null; }
      }

      async function tryGemini(prompt) {
        const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_KEY}`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ contents: [{ role: "user", parts: [{ text: SOUL + "\nUser: " + prompt + "\nADAM:" }] }] })
        });
        const data = await res.json();
        const text = data.candidates[0].content.parts[0].text;
        document.getElementById('response').lastChild.innerHTML += text.replace(/\n/g, "<br>");
        return text;
      }

      function speakAloud(text) {
        const utterance = new SpeechSynthesisUtterance(text);
        const voice = speechSynthesis.getVoices().find(v => v.name.includes("Daniel") || v.name.includes("Google UK English Male"));
        if (voice) utterance.voice = voice;
        speechSynthesis.speak(utterance);
      }
    }
  </script>
</body>
</html>
